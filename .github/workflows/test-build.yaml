name: Build and test nix config

on: [push, pull_request]

jobs:
  build-vm:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Install Nix
        uses: cachix/install-nix-action@v22

      - name: Check nix flake
        run: |
          nix flake check

      - name: Build nix config
        run: |
          nix build .#nixosConfiguration.system.config.system.build.toplevel

